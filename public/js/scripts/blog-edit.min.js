define(["require","exports","jquery","simplemde","marked","bootstrap_select","bootstrap_validator"],function(require,exports,$,SimpleMDE,Marked){"use strict";return function(){function BlogEdit(element_id,blog){this.blog=blog;var _this=this;_this.simplemde=new SimpleMDE({element:document.getElementById(element_id),previewRender:function(text){return Marked(text)},promptURLs:!0,initialValue:_this.blog.content,autosave:{enable:!0,uniqueid:"simplemde_id",delay:1e4}}),$(document).ready(function(){$("select").selectpicker(),$("#tag-select").selectpicker("val",_this.blog.tags.map(function(tag){return tag._id})),$("#blog-type").selectpicker("val",_this.blog.type),$("#blog-active").selectpicker("val",_this.blog.isActive?"1":"0"),$("form").validator().on("submit",function(e){!e.isDefaultPrevented()&&(e.preventDefault(),_this.save())})})}return BlogEdit.prototype.save=function(){var data={imageUrl:$('[name="image"]').val(),preview:$('[name="preview"]').val(),content:this.getText(),tags:$("#tag-select").selectpicker("val"),type:$("#blog-type").selectpicker("val"),isActive:"1"===$("#blog-active").selectpicker("val")},tags=$("#blog-new-tags").val().split(", ");tags.length&&tags[0]&&(data.new_tags=tags),$.ajax({url:"/admin/blog/edit/"+this.blog._id,method:"POST",data:JSON.stringify(data),contentType:"application/json"}).then(function(){window.location.replace("/admin/blogs")})},BlogEdit.prototype.getText=function(){return this.simplemde.value()},BlogEdit}()});